#!/usr/bin/env bash
set -e

ROOT=$(git rev-parse --show-toplevel)

commit_hash=$(git rev-parse HEAD)
commit_date=$(git show -s --format=%ci HEAD)

OUT="$ROOT/src/Lution/modules/configcheck/VERSION.py"

cat > "$OUT" <<EOF
# AUTO GENERATED, DO NOT MODIFY
# sigmas
GIT_COMMITT = "$commit_hash"
COMMIT_DATE = "$commit_date"

from github import Github

g = Github()
repo = g.get_repo("lutionhq/lution")
ltcommit = repo.get_commits()[0]

if ltcommit.sha.startswith(GIT_COMMITT):
    GIT_COMMIT = f"{GIT_COMMITT}"
else:
    GIT_COMMIT = f"{GIT_COMMITT} (outdated)"

EOF

git add "$OUT"
